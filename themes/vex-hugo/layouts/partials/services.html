{{ $data := index .Site.Data .Site.Language.Lang }}

{{ if $data.homepage.services.enable }}
{{ with $data.homepage.services }}
<section class="feature-list section">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        {{ if .title }}
        <div class="heading">
          <h2>{{ $.Page.RenderString .title }}</h2>
        </div>
        {{ end }}
      </div>
    </div>
    {{ range $index, $element := (where .items "enable" true) }}
    {{- if (mod $index 2) }}
    <div class="row item-row">
      <div class="col-md-6 text-center p-md-7 p-5 mb-lg-0 zoom">
        {{/* HUGO IMAGE RENDERER */}}
        {{ $img_data := newScratch }}
        {{ $image_class := "img-fluid"}}
        {{ $image_path := .image }}
        {{ $image := resources.Get $image_path }}
        {{ $image_fallback := partial "imageConverter.html" (dict "ImageSrc" $image "ImgParam" (printf "%s jpg #fafafa q90 Lanczos" (index $resolutions 1))) }}
        {{ $resolutions := (slice "300x" "500x" "800x") }}
        {{ range $index, $resolutions }}
            {{ $image_webp := partial "imageConverter.html" (dict "ImageSrc" $image "ImgParam" (printf "%s webp q90 Lanczos" .)) }}
            {{ $img_data.Add "srcset_webp" (printf "%s %s," $image_webp (replace . "x" "w")) }}
            {{ $image_jpg := partial "imageConverter.html" (dict "ImageSrc" $image "ImgParam" (printf "%s jpg #fafafa q90 Lanczos" .)) }}
            {{ $img_data.Add "srcset_jpg" (printf "%s %s," $image_jpg (replace . "x" "w")) }}
        {{ end }}
				{{ $new_size := $image.Resize (index $resolutions 1) }}
        <picture>
            <source type="image/webp" srcset='{{ $img_data.Get "srcset_webp" }}'>
            <source type="image/jpeg" srcset='{{ $img_data.Get "srcset_jpg" }}'>
            <img loading="lazy" class="{{ $image_class }}" src="{{ $image_fallback }}" width="{{ $new_size.Width }}" height="{{ $new_size.Height }}" alt='Illustration of {{ $image_path | replaceRE ".*?([\\w-]+).png" "$1" }} service'>
        </picture>
        {{/* HUGO IMAGE RENDERER */}}
      </div>
      <div class="col-md-6 align-self-center text-center text-md-left">
        <div class="content">
          <h3 class="subheading">{{ $.Page.RenderString .title }}</h3>
          <p>{{ $.Page.RenderString .content }}</p>
          {{ if .link.enable }}
          {{ with .link }}
          <p><a href="{{ .link | absLangURL }}" class="link-primary">{{ .label }}</a></p>
          {{ end }}
          {{ end }}
        </div>
      </div>
    </div>
    {{- else }}
    <div class="row item-row">
      <div class="col-md-6 order-md-1 order-2 align-self-center text-center text-md-left">
        <div class="content">
          <h3 class="subheading">{{ $.Page.RenderString .title }}</h3>
          <p>{{ $.Page.RenderString .content }}</p>
          {{ if .link.enable }}
          {{ with .link }}
          <p><a href="{{ .link | absLangURL }}" class="link-primary">{{ .label }}</a></p>
          {{ end }}
          {{ end }}
        </div>
      </div>
      <div class="col-md-6 order-md-2 order-1 text-center p-5 mb-lg-0 zoom">
        {{/* HUGO IMAGE RENDERER */}}
        {{ $img_data := newScratch }}
        {{ $image_class := "img-fluid"}}
        {{ $image_path := .image }}
        {{ $image := resources.Get $image_path }}
        {{ $image_fallback := partial "imageConverter.html" (dict "ImageSrc" $image "ImgParam" (printf "%s jpg #fafafa q90 Lanczos" (index $resolutions 1))) }}
        {{ $resolutions := (slice "300x" "500x" "800x") }}
        {{ range $index, $resolutions }}
            {{ $image_webp := partial "imageConverter.html" (dict "ImageSrc" $image "ImgParam" (printf "%s webp q90 Lanczos" .)) }}
            {{ $img_data.Add "srcset_webp" (printf "%s %s," $image_webp (replace . "x" "w")) }}
            {{ $image_jpg := partial "imageConverter.html" (dict "ImageSrc" $image "ImgParam" (printf "%s jpg #fafafa q90 Lanczos" .)) }}
            {{ $img_data.Add "srcset_jpg" (printf "%s %s," $image_jpg (replace . "x" "w")) }}
        {{ end }}
				{{ $new_size := $image.Resize (index $resolutions 1) }}
        <picture>
            <source type="image/webp" srcset='{{ $img_data.Get "srcset_webp" }}'>
            <source type="image/jpeg" srcset='{{ $img_data.Get "srcset_jpg" }}'>
            <img loading="lazy" class="{{ $image_class }}" src="{{ $image_fallback }}" width="{{ $new_size.Width }}" height="{{ $new_size.Height }}" alt='Illustration of {{ $image_path | replaceRE ".*?([\\w-]+).png" "$1" }} service'>
        </picture>
        {{/* HUGO IMAGE RENDERER */}}
      </div>
    </div>
    {{ end }}
    {{ end }}
  </div>
</section>
{{ end }}
{{ end }}
